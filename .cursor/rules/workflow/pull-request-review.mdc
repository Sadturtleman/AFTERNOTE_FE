---
description: Pull Request 작성 및 코드 리뷰 규칙
globs: "**/*"
alwaysApply: true
---

# Pull Request & Code Review Rules (PR 및 코드 리뷰 규칙)

## Pull Request 작성 규칙 - Critical

**PR을 생성할 때는 아래 항목을 반드시 포함하여, 해당 PR이 어떤 내용을 다루거나 수정한 것인지 명확히 기술해야 합니다.**

### 1. PR 제목 (Title)

- **Conventional Commits 타입을 포함**합니다. (`git-policy.mdc`의 Conventional Commits 형식과 동일)
- 형식: `type(scope): subject` 또는 `[type] subject`
- **Types**: `feat`, `fix`, `refactor`, `style`, `docs`, `test`, `chore`, `build`, `ci`, `perf`

#### 예시
- `feat(mainpage): 애프터노트 작성 화면 플레이리스트 곡 수 동기화`
- `fix(edit): 노래 추가 화면 뒤로가기 시 잘못된 카테고리 복원 문제`
- `refactor(nav): MemorialPlaylist 공유 상태 holder 도입`

### 2. PR 본문 (Description) 필수 항목

다음 항목을 포함하여 **어떤 내용을 다루거나 수정했는지**를 구체적으로 작성합니다.

| 항목 | 설명 | 예시 |
|------|------|------|
| **목적 / 배경** | 이 PR이 해결하려는 문제나 추가하려는 기능 | "작성 화면 곡 수와 노래 추가 화면 곡 수 불일치", "뒤로가기 시 소셜네트워크로 초기화되는 문제" |
| **변경 사항 요약** | 수정/추가된 내용을 bullet으로 간단히 | - NavGraph에 playlistStateHolder, editState 호이스팅<br>- AddSongScreen에 currentPlaylistCount 전달 |
| **주요 수정 파일** | 변경된 주요 경로 (선택) | `NavGraph.kt`, `AfternoteEditScreen.kt`, `AddSongScreen.kt` |
| **테스트/검증** | 수행한 확인 내용 (가능 시) | "추모 가이드라인 → 노래 추가 → 뒤로가기 시 추모 가이드라인 유지 확인" |

#### PR 본문 템플릿 (선택 사용)

```markdown
## 목적 / 배경
- 

## 변경 사항 요약
- 

## 주요 수정 파일
- 

## 테스트/검증
- 
```

### 3. PR 작성 시 주의사항

- **타입과 scope를 생략하지 않습니다.** PR만 봐도 `feat`/`fix`/`refactor` 등 성격을 알 수 있어야 합니다.
- **subject는 한글로**, 변경 의도를 한 문장으로 요약합니다.
- 여러 타입이 섞인 경우, **가장 비중이 큰 타입 하나**를 선택하고, 본문에 나머지를 기술합니다.

---

## PR 통과 조건 (CI) - Critical

**PR이 merge되려면 CI가 모두 통과해야 합니다.** 코드 리뷰 Approve만으로는 부족하고, 아래가 만족되어야 합니다.

- **Commitlint:** PR 내 **모든** 커밋이 commitlint 규칙을 만족해야 합니다. 최신 커밋뿐 아니라 base..head 범위의 전체 커밋이 검사됩니다.
- **Ktlint:** PR 브랜치의 코드 전체가 ktlint를 통과해야 합니다.

PR 생성·업데이트 전에 로컬에서 `npx commitlint --from=<base> --to=HEAD`로 범위 내 모든 커밋을 검사하고, `./gradlew ktlintCheck`로 코드를 검사해 두는 것을 권장합니다.

---

## 코드 리뷰 규칙 - Critical

**코드 리뷰 없이 바로 merge하면, 잘못된 부분이 수정되지 않은 채 merge될 수 있습니다. 서로의 PR에 대해 코드 리뷰를 진행한 후 merge합니다.**

### 1. 코드 리뷰 필수 원칙

- **리뷰 전 merge 금지**: Approve 또는 적어도 1인 이상의 코드 리뷰가 완료되기 전에는 **merge하지 않습니다**.
- **서로 리뷰**: 팀원 간 서로 PR에 대해 리뷰를 작성하고, 논의가 끝난 뒤 merge합니다.
- **자동 merge 지양**: "자동 squash merge", "빠른 merge" 등으로 리뷰 단계를 건너뛰지 않습니다.

### 2. 리뷰 시 확인할 것 (가이드)

- **동작/로직**: 요구사항 대로 동작하는지, 엣지 케이스는 없는지
- **아키텍처/의존성**: 레이어 분리, Feature 간 직접 참조, 불필요한 의존성
- **코드 품질**: 네이밍, 함수 길이, 매직 넘버, `@Suppress` 남발 여부
- **리소스/성능**: 메모리, Compose 재구성, 불필요한 remember/LaunchedEffect
- **규칙 준수**: `code-quality.mdc`, `architecture.mdc`, `compose.mdc`, `git-policy.mdc` 등 프로젝트 규칙 위반 여부

### 3. 리뷰 코멘트 작성

- **건설적으로** 기술: "이렇게 바꾸면 어떨까요?", "여기서 ~가 우려됩니다"
- **구체적으로** 기술: "이 로직은 ~일 때 ~가 됩니다. ~로 분리하는 것을 제안합니다"
- **필수/권장 구분**: 반드시 수정(Request changes) vs 개선 제안(Comment)을 구분하면 좋습니다.

### 4. 리뷰 후 merge

- **Request changes**가 해결되거나, **Comment**에 대해 작성자와 합의가 이루어진 뒤 merge합니다.
- 긴급/트리비얼 변경은 팀 합의에 따라 리뷰 생략을 허용할 수 있으나, **예외로 두고 기본은 리뷰 후 merge**를 원칙으로 합니다.

---

## 워크플로우 요약

```
브랜치 작업 → 커밋(Conventional Commits, 모든 커밋 commitlint 통과) → 푸시
  → PR 생성 (제목: type(scope): subject, 본문: 목적/변경사항/수정 파일/검증)
  → CI 통과 (commitlint: PR 전체 커밋, ktlint: 브랜치 코드)
  → 코드 리뷰 요청
  → 팀원 리뷰 (Comment / Request changes)
  → 피드백 반영 또는 논의
  → Approve 후 merge
```
