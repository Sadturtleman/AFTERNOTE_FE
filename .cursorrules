# ⚠️ CRITICAL RULES SUMMARY - READ FIRST

**This section contains the core rules that AI must recognize first. For detailed explanations, refer to `.cursor/rules/*.mdc` files.**

---
# GIT PROTOCOL - STRICT ENFORCEMENT (Highest Priority)
</critical_instruction>

## MUST DO
1. **Git**:
   - **Verification**: Before push command, **must first verify** that current branch is not `main`/`develop`
   - **Commitlint**: 커밋 메시지의 모든 줄(subject, body, footer)은 **100자 이내**. 긴 내용은 줄바꿈으로 분리
2. **Branch (Recommended)**: Prefer using an appropriate branch (`feat/`, `fix/`, `docs/`, etc.)
3. **Branch Cleanup**: After a successful merge to `main`, delete merged branches
   - **Local**: Delete branches that are merged into `main` (excluding `main`/`develop`/`master`)
4. **Preview**: All public Composables must have `@Preview`
7. **Modifier**: If a Composable has a modifier parameter, it should be placed first.
8. **State**: State hoisting to caller, Stateless composable preferred
   - **Complete State Hoisting**: All screen states (tabs, navigation items, etc.) must move to ViewModel
9. **Architecture**: Presentation → Domain ← Data (strict layer separation)
11. **ViewModel Injection**: `@HiltViewModel` uses `hiltViewModel()`, regular ViewModel uses `viewModel()`
12. **StateFlow Collection**: Use `collectAsStateWithLifecycle()` (never use `collectAsState()`)
13. **`.cursorrules` Management**: If this file exceeds 300 lines, consider splitting or keeping only core rules
15. **HTTP Status Code Tests Required**: ViewModels using Swagger-documented APIs must include HTTP error tests
    - 400 Bad Request, 401 Unauthorized, 404 Not Found, 500 Server Error
    - Network Error (IOException)
    - See `.cursor/rules/quality/code-quality.mdc` for details

## MUST NOT DO
3. `android.R` import
4. Wildcard imports (`import foo.*`)
5. Android/Data dependencies in Domain Layer
8. **File Modification in Ask Mode**: In Ask mode, STRICTLY ANSWER ONLY. Do not attempt file modification. Interpret questions as pure curiosity, not criticism or modification requests.
9. **ViewModel Injection Confusion**: Never use `viewModel()` for `@HiltViewModel` (runtime error)
10. **Non Lifecycle-aware State Collection**: Never use `collectAsState()` (memory leak risk)
11. **Local State Management**: Never manage screen state with `remember { mutableStateOf() }` inside Composable (move to ViewModel)

## CRITICAL PATTERNS
- **Figma parity**: Hardcoded `dp` values are allowed in UI to quickly verify margins match Figma.
 Avoid creating “new” values via meaningless arithmetic (e.g. `16.dp - 8.dp`).
- **Named Arguments Pattern**: Use explicit parameter names for readability and safety. Use `FontWeight.Medium` instead of `FontWeight(500)`. 
- **Rem-based Design**: Large spacing (24dp+) uses `weight` and `Arrangement`, small spacing (≤8dp) uses `Spacer`, component sizes always fixed dp
- **Maximize Core Component Reuse**: Maximize reuse of common components in `core` module (`Header`, `LabeledTextField`, `MessageTextField`, `CustomRadioButton`, etc.)
- **Component Overloading**: When overall structure is similar but details differ, use **overloading** instead of separate components
- **Component Reuse**: If uncertain, use `private` function; if reuse confirmed, separate file
- **File Limit**: Split if exceeds 400 lines, maintain 10-15 files per folder
- **`.cursorrules` Optimization**: Recommend ≤300 lines, consider splitting to `.cursor/rules/*.mdc` if exceeded
- **Tests**: Check/add tests when UseCase/ViewModel changes
- **Parameter Refactoring Pattern**: When 10+ parameters needed, don't just wrap in data class, apply **section-based grouping** pattern
- **State Holder Pattern for Cognitive Complexity**: Must apply **State Holder pattern** to keep SonarQube cognitive complexity ≤15. No lambda definitions inside Composable, all logic moves to State class
- **Slot API Pattern (Composition over Inheritance)**: When unifying components with similar structure, use **composition, not inheritance**. Provide common shell and inject content via Slot (`content: @Composable () -> Unit`)
- **Component Location Rules**: Common components must be in `core` module. Direct dependencies between Feature modules are prohibited, common components must be in `core`
- **Code Structure Improvement Before @Suppress**: When detekt warning occurs, must try code structure improvement before using `@Suppress`. When parameters increase after State Hoisting pattern, group with Event Interface or State Class
- **Required Verification on Structure Changes**: File moves, package changes, class refactoring must follow: pre/post build check, search all usages, batch import path changes
---

# Project Context
- **Project Type**: Android App (Kotlin, Jetpack Compose)
- **Architecture**: Clean Architecture (Data, Domain, Presentation Layers)
- **Dependency Injection**: Hilt
- **Navigation**: Navigation Compose (Type-safe with kotlinx.serialization)
- **Code Quality**: Detekt
- **JDK**: JDK 21 (Eclipse Adoptium)

---

# Rule File Structure

This project uses `.cursor/rules/*.mdc` file structure to separate rules:

- **`.cursor/rules/workflow/git-policy.mdc`**: Git operations and branch management policy (always applied: `alwaysApply: true`)
- **`.cursor/rules/workflow/branch-workflow.mdc`**: Branch work and workflow rules (always applied: `alwaysApply: true`)
- **`.cursor/rules/workflow/api-implementation.mdc`**: API implementation rules (Swagger-first)
- **`.cursor/rules/workflow/pull-request-review.mdc`**: Pull Request and code review rules
- **`.cursor/rules/tech-stack/architecture.mdc`**: Clean Architecture and layer separation rules
- **`.cursor/rules/tech-stack/compose.mdc`**: Jetpack Compose coding rules and patterns
- **`.cursor/rules/tech-stack/android-kotlin.mdc`**: Android/Kotlin coding conventions and Import rules
- **`.cursor/rules/tech-stack/optimistic-updates.mdc`**: Optimistic Updates pattern
- **`.cursor/rules/quality/code-quality.mdc`**: Code quality, formatting, test rules

Each `.mdc` file uses `globs` pattern so rules are injected only when opening or working on related files.
**Workflow rules (Git, branch) are applied to all files, so set `alwaysApply: true`.**

---

# General Guidelines

## Basic Principles

3. **Work on Appropriate Branch**
   - See `.cursor/rules/workflow/branch-workflow.mdc` for details

4. **`.cursorrules` File Writing Rules**
   - **Critical Rules Summary Required at Top**: When writing or modifying `.cursorrules` file, must include "⚠️ CRITICAL RULES SUMMARY" section at the top
   - **Summary Structure**:
     * MUST DO: List core rules concisely
     * MUST NOT DO: Clearly mark prohibited items
     * CRITICAL PATTERNS: Important pattern summary
   - **Purpose**: Enable AI to recognize core rules at the beginning of Context Window to prevent rule ignoring or hallucination

5. **Memo of Attempted Solutions**
   - When solving problems, memo attempted methods
   - To avoid repeating same mistakes

7. **Component Preview Required**
   - All component functions must include Preview function with `@Preview` annotation
   - Previews should show various states (selected/not selected, enabled/disabled, etc.)
   - Exception: Internal-only components (`internal` functions) are optional

## Problem Solving & Research Rules

### ⚠️ Critical: Required Verification Procedure on Structure Changes
**When performing structural changes (file moves, package changes, class refactoring), must follow these procedures:**

2. **Search All Usages**: Search all locations where file to move/change is used with `grep` and list them
3. **Batch Import Path Changes**: Change import paths at all usages at once (don't do step by step, understand whole first)
4. **Variable/Function Name Changes**: When changing variable/function names, check all usages with `grep` then change in batch
6. **State/Params Class Moves**: When moving State or Params classes, check import paths of all components using that class
7. **Duplicate Removal**: Before removing duplicate files, check all usages, unify to one, then update all import paths

### Perplexity Prompt Writing Request Rules - Critical
**When user explicitly requests "퍼플렉시티 프롬프트 작성해" or "Perplexity 프롬프트 작성해":**
- **Provide Prompt Content Only**: Provide only content to paste into prompt, nothing else
- **No Additional Explanation**: Do not include guidance like "paste this prompt into Perplexity" after writing prompt
- **No Code Modification**: Do not modify code simultaneously with prompt writing
- **Format**: Provide prompt as plain text without markdown code blocks (so user can copy-paste immediately)

---

# ⚠️ CRITICAL RULES RE-CONFIRMATION (File End - Sandwich Technique)

**When reading this file, must re-confirm the core rules above:**

## Highest Priority Rules (Never Ignore)
1. **Git Work Pre-Verification**: Before commit/push command generation, **must first verify** that current branch is not `main`/`develop`
3. **`.cursorrules` Length Management**: If this file exceeds 300 lines, consider splitting or keeping only core rules

## Core Technical Rules
- **ViewModel Injection**: `@HiltViewModel` uses `hiltViewModel()`
- **StateFlow Collection**: Use `collectAsStateWithLifecycle()` (never use `collectAsState()`)
- **State Hoisting**: All screen states move to ViewModel
- **Preview Required**: All public Composables must have `@Preview`

## Rule File References
- For detailed rules, refer to `.cursor/rules/*.mdc` files
- Each file uses `globs` pattern so rules are automatically injected during related work

**Violating the above rules may cause serious problems. Must comply.**
